{% extends "base.html" %}

{% block content %}
<div id="status-container" style="text-align: center;">
    <h2>Processing...</h2>
    <div style="background: #e0e0e0; border-radius: 4px; height: 20px; overflow: hidden; margin: 20px 0;">
        <div id="progress-bar" style="background: #3498db; width: 0%; height: 100%; transition: width 0.5s;"></div>
    </div>
    <p id="status-text">Initializing...</p>

    <div id="download-section" style="display: none; margin-top: 20px;">
        <a id="download-link" href="#" class="button"
            style="background: #27ae60; color: white; padding: 12px 24px; text-decoration: none; border-radius: 4px;">Download
            Updated Excel</a>
        <br><br>
        <a href="/">Process Another File</a>
    </div>
</div>

<script>
    const jobId = "{{ job_id }}";

    function checkStatus() {
        fetch(`/status/${jobId}`)
            .then(response => response.json())
            .then(data => {
                const percent = Math.round((data.progress / data.total) * 100) || 0;
                document.getElementById('progress-bar').style.width = percent + '%';
                document.getElementById('status-text').innerText = `${data.message} (${data.progress}/${data.total})`;

                if (data.status === 'completed') {
                    document.getElementById('status-container').querySelector('h2').innerText = "Complete!";
                    document.getElementById('download-section').style.display = 'block';
                    document.getElementById('download-link').href = `/download/${jobId}`;
                } else if (data.status === 'failed') {
                    document.getElementById('status-container').querySelector('h2').innerText = "Failed";
                    document.getElementById('progress-bar').style.background = '#e74c3c';
                } else {
                    setTimeout(checkStatus, 1000);
                }
            })
            .catch(err => console.error(err));
    }

    checkStatus();
</script>
{% endblock %}